
# JNI Example (Mac OS, C++)

JNI (Java Native Interface) allows implementing methods in C/C++, and use them in Java.

## 1. Create `HelloJNI.java` file

```java
public class HelloJNI {  // Save as HelloJNI.java
    static {
        System.loadLibrary("hello"); // Load native library hello.dll (Windows) or libhello.so (Unixes)
        //  at runtime
        // This library contains a native method called sayHello()
    }

    // Declare an instance native method sayHello() which receives no parameter and returns void
    private native void sayHello();

    // Test Driver
    public static void main(String[] args) {
        new HelloJNI().sayHello();  // Create an instance and invoke the native method
    }
}
```

## 2. Compile the `HelloJNI.java` file

This gives you `HelloJNI.class`:

```
javac HelloJNI.java
```

## 3. Codegen `.h` file for JNI

```
javac -h . HelloJNI
```

This gives you `HelloJNI.h` (do not edit it manually!):

```c
/* DO NOT EDIT THIS FILE - it is machine generated */
#include <jni.h>
/* Header for class HelloJNI */

#ifndef _Included_HelloJNI
#define _Included_HelloJNI
#ifdef __cplusplus
extern "C" {
#endif
/*
 * Class:     HelloJNI
 * Method:    sayHello
 * Signature: ()V
 */
JNIEXPORT void JNICALL Java_HelloJNI_sayHello
  (JNIEnv *, jobject);

#ifdef __cplusplus
}
#endif
#endif
```

## 4. Create `HelloJNI.c`

Native implementation:

```c
// Save as "HelloJNI.cpp"
#include <jni.h>       // JNI header provided by JDK
#include <iostream>    // C++ standard IO header
#include "HelloJNI.h"  // Generated
using namespace std;

// Implementation of the native method sayHello()
JNIEXPORT void JNICALL Java_HelloJNI_sayHello(JNIEnv *env, jobject thisObj) {
	cout << "Hello World from C++!" << endl;
   return;
}
```

## 5. Compile C++ library

**IMPORTANT:** library extension should exactly be `.jnilib` (not `.so`!), and should have `lib` prefix, i.e. `libhellp.jnilib`:

```
g++ -fPIC -I"$JAVA_HOME/include" -I"$JAVA_HOME/include/darwin/" -shared -o libhello.jnilib HelloJNI.cpp

```

NOTICE: the `$JAVA_HOME` can be taken from (for `1.8` version in this case):

```
export JAVA_HOME="$(/usr/libexec/java_home -v 1.8)"
```

## 6. Execute the java class

Notice, we set `java.library.path` to current directory, where the `libhello.jnilib` was compiled to:

```
java HelloJNI
or
java -Djava.library.path=. HelloJNI
```

Result:

```
Hello World from C++!
```